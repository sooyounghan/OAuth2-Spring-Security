-----
### íŒŒì¼ êµ¬ì„±
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/58a8a8d3-87ca-44da-8f2f-6f3f58b27d95">
</div>

1. ê° OAuth2 ì„œë¹„ìŠ¤ ì œê³µìë“¤ì˜ ì—°ë™ì„ í†µí•´ ì¸ì¦ ë° ì¸ê°€ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê³µí†µ í•­ëª©ì€ ì¶”ìƒí™”
2. OpenID Connect Providerë¥¼ ì§€ì›í•˜ëŠ” ì„œë²„ì™€ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì„œë²„ì— ëŒ€í•˜ì—¬ ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì—°ë™ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë‚´ë¶€ ì›ë¦¬ ì´í•´
3. OAuth2UserServiceë¥¼ ì»¤ìŠ¤í…€ë§ˆì´ì§•í•˜ì—¬ ì¸ì¦ ì´í›„ íšŒì› ê°€ì… ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¶€ê°€ ì„œë¹„ìŠ¤ êµ¬í˜„
4. OAuth2Userì™€ OidcUser ì²˜ë¦¬ë¥¼ êµ¬ë¶„í•˜ì—¬ êµ¬í˜„, ìŠ¤í”„ë§ MVCì—ì„œ íƒ€ì…ë³„ë¡œ ì¸ì¦ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ë°©ë²• í™•ì¸
5. Scopeì˜ ì •ë³´ë¥¼ ê¶Œí•œ ì •ë³´ë¡œ ë§¤í•‘í•˜ëŠ” ì›ë¦¬ íŒŒì•…, ì´ë¥¼ ì»¤ìŠ¤í…€ ë§ˆì´ì§•

-----
### Google ì—°ë™ ì ˆì°¨
-----
1. OAuth2 Clientì™€ Google ì¸ê°€ ì„œë²„ì™€ì˜ ì—°ë™ì„ í†µí•´ ì¸ì¦ / ì¸ê°€ í”„ë¡œì„¸ìŠ¤ êµ¬í˜„
2. êµ¬ê¸€ ì„œë¹„ìŠ¤ì— ì‹ ê·œ ì„œë¹„ìŠ¤ ìƒì„± : ```https://console.cloud.google.com```
  - í”„ë¡œì íŠ¸ ì„ íƒ - ìƒˆ í”„ë¡œì íŠ¸ - í”„ë¡œì íŠ¸ ì´ë¦„ (google-client-app) ìƒì„±
  - ë©”ë‰´ì˜ API ì„œë¹„ìŠ¤ - OAuth ë™ì˜ í™”ë©´ - ì•± ì´ë¦„ (my-google-client-app), ì‚¬ìš©ì ì§€ì› ì´ë©”ì¼ / ëŒ€ìƒ : ì™¸ë¶€ / ì—°ë½ì²˜ ì •ë³´
  - ë²”ìœ„ ì„¤ì • : ë°ì´í„° ì•¡ì„¸ìŠ¤ - ë²”ìœ„ ì¶”ê°€ ë˜ëŠ” ì‚­ì œ - .../auth/userinfo.email, .../auth/userinfo.profile, openid ì„ íƒ
  - í´ë¼ì´ì–¸íŠ¸ - ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸° - OAuth í´ë¼ì´ì–¸íŠ¸ ID - ìœ í˜• : ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜, ìŠ¹ì¸ëœ ë¦¬ë‹¤ì´ë ‰ì…˜ URI (```http://localhost:8081/login/oauth2/code/google```)
  - í´ë¼ì´ì–¸íŠ¸ IDì™€ í´ë¼ì´ì–¸íŠ¸ ë³´ì•ˆ ë¹„ë°€ë²ˆí˜¸ ìƒì„±

3. application.yml ì„¤ì •
<div align="center">
<img src="https://github.com/user-attachments/assets/aac02745-03d6-4ce6-8451-cc210097df25">
</div>

  - client_id, client_secret í•„ìš”

-----
### Naver ì—°ë™ ì ˆì°¨
-----
1. OAuth2 Clientì™€ Naver ì¸ê°€ ì„œë²„ì™€ì˜ ì—°ë™ì„ í†µí•´ ì¸ì¦ / ì¸ê°€ í”„ë¡œì„¸ìŠ¤ êµ¬í˜„
2. ë„¤ì´ë²„ APIì— ì‹ ê·œ ì„œë¹„ìŠ¤ ìƒì„± : ```https://developers.naver.com/main/```
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ - ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ (naver-client-app2) / ì‚¬ìš© API : ë„¤ì´ë²„ ë¡œê·¸ì¸ (íšŒì› ì´ë¦„, ì—°ë½ì²˜ ì´ë©”ì¼ ì£¼ì†Œ, í”„ë¡œí•„ ì‚¬ì§„ í•„ìˆ˜)
  - ì„œë¹„ìŠ¤ URL : http://localhost:8081
  - ë¡œê·¸ì¸ ì˜¤í”ˆ API ì„œë¹„ìŠ¤ í™˜ê²½ (PC ì›¹)ì—ì„œ ë„¤ì´ë²„ ë¡œê·¸ì¸ Callback URL (```http://localhost:8081/login/oauth2/code/naver```)
  - í´ë¼ì´ì–¸íŠ¸ IDì™€ í´ë¼ì´ì–¸íŠ¸ Secret ìƒì„±

3. application.yml ì„¤ì •
<div align="center">
<img src="https://github.com/user-attachments/assets/d95e44b2-5d41-47d2-ad46-6ab444cc0348">
</div>

  - NaverëŠ” ê¸°ë³¸ ì„¤ì •ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, registration, provider ì •ë³´ í•„ìš”

-----
### Keycloak ì—°ë™ ì ˆì°¨
-----
1. OAuth2 Clientì™€ Keycloak ì¸ê°€ ì„œë²„ì™€ì˜ ì—°ë™ì„ í†µí•´ ì¸ì¦ / ì¸ê°€ í”„ë¡œì„¸ìŠ¤ êµ¬í˜„
2. ```https://localhost:8080```
3. application.yml ì„¤ì •
<div align="center">
<img src="https://github.com/user-attachments/assets/3649e7b3-1833-47b9-9629-901d733bef0a">
</div>

-----
### ê¸°ë³¸ ì„¤ì •
-----
1. index.html
```html
<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/static/css/owl.carousel.min.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">

  <!-- Style -->
  <link rel="stylesheet" href="/static/css/style.css">

  <title>Login</title>
</head>
<body>
<div class="content">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-5" sec:authorize="isAnonymous()">
        <div class="social-login text-center">
          <a th:href="@{/oauth2/authorization/google}" class="google btn btn-block">
            <span>Sign in with Google</span>
          </a>
          <a th:href="@{/oauth2/authorization/naver}" class="naver btn btn-block">
            <span>Sign in with Naver</span>
          </a>
          <a th:href="@{/oauth2/authorization/keycloak}" class="keycloak btn btn-block">
            <span>Sign in with Keycloak</span>
          </a>
        </div>
      </div>
      <div class="col-md-5">
        <div class="social-login text-center">
          <div sec:authorize="isAuthenticated()">
            <div><h2>ì•ˆë…•í•˜ì„¸ìš” <span th:text="${user}"/> ë‹˜</h2></div>
            </br></br>
            <a th:href="@{/api/user}" class="keycloak btn btn-block">OAuth2 ì¸ì¦ ì •ë³´</a>
            <a th:href="@{/api/oidc}" class="keycloak btn btn-block">OpenID Connect ì¸ì¦ ì •ë³´</a></br></br>
            <a th:href="@{/logout}" class="google btn btn-block">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/static/js/jquery-3.3.1.min.js"></script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/main.js"></script>
</body>
</html>
```

2. HomeController
```java
package io.security.oauth2.springsecurityoauth2.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HomeController {
    @GetMapping("/home")
    public String home() {
        return "home";
    }
}
```

3. IndexController
```java
package io.security.oauth2.springsecurityoauth2.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class IndexController {

    @GetMapping("/")
    public String index() {
        return "index";
    }
}
```

4. OAuth2ClientConfig
```java
package io.security.oauth2.springsecurityoauth2;

import org.springframework.context.annotation.Bean;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;
import org.springframework.security.web.SecurityFilterChain;

@EnableWebSecurity
public class OAuth2ClientConfig {

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() {
        return (web) -> web.ignoring().antMatchers("/static/js/**", "/static/images/**", "/static/css/**", "/static/scss/**");
    }
    
    @Bean
    SecurityFilterChain oauth2ClientSecurityFilterChain(HttpSecurity http) throws Exception {
        http.authorizeRequests(authRequest -> authRequest
                .antMatchers("/").permitAll()
                .anyRequest().authenticated());

        http.oauth2Login(Customizer.withDefaults());

        http.logout().logoutSuccessUrl("/");

        return http.build();
    }
}
```

-----
### application.yml
-----
```yml
server:
  port: 8081

spring:
  security:
    oauth2:
      client: ## prefix
        registration: ## í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (Map ì†ì„±)
          keycloak: ## (Mapì˜ í‚¤ ê°’)
            authorizationGrantType: authorization_code
            clientId: oauth2-client-app
            clientName: oauth2-client-app
            clientSecret: zxMvv3yCjZVoEJFAUzNUdYlJgJla9yuf
            clientAuthenticationMethod: client_secret_basic
            redirectUri: http://localhost:8081/login/oauth2/code/keycloak
            scope: openid, profile

          google:
            client-id: 297586071592-qld2a4k62eucouleq2edokab0f7s7gn9.apps.googleusercontent.com
            client-secret: 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
            scope: openid, profile, email

          naver:
            authorization-grant-type: authorization_code
            client-id: DgOv9nXsx8v1oWQfw6Jy
            client-secret: J_F8G72aH9
            client-name: naver-client-app2
            redirect-uri: http://localhost:8081/login/oauth2/code/naver
            scope: profile, email

        provider: ## : ê³µê¸‰ì ì„¤ì • (Map ì†ì„±)
            keycloak: ## (Mapì˜ í‚¤ ê°’)
              authorizationUri: http://localhost:8080/realms/oauth2/protocol/openid-connect/auth
              issuerUri: http://localhost:8080/realms/oauth2
              jwkSetUri: http://localhost:8080/realms/oauth2/protocol/openid-connect/certs
              tokenUri: http://localhost:8080/realms/oauth2/protocol/openid-connect/token
              userInfoUri: http://localhost:8080/realms/oauth2/protocol/openid-connect/userinfo
              userNameAttribute: preferred_username
 
            naver: #ë„¤ì´ë²„ì˜ ê²½ìš°, ì™¸ë¶€ ì„œë¹„ìŠ¤ ì´ìš©ìì´ë¯€ë¡œ ì„¤ì • í•„ìš”
              authorization-uri: https://nid.naver.com/oauth2.0/authorize
              token-uri: https://nid.naver.com/oauth2.0/token
              user-info-uri: https://openapi.naver.com/v1/nid/me
              user-name-attribute: response

  mvc:
    static-path-pattern: "/static/**" ## ì •ì  ë¦¬ì†ŒìŠ¤ ë§¤í•‘ íŒ¨í„´ (ê¸°ë³¸ : ë£¨íŠ¸(/**)) ë³€ê²½
```

  - ë„¤ì´ë²„ ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ í™•ì¸ : ê°œë°œ ê°€ì´ë“œ (```https://developers.naver.com/docs/login/devguide/devguide.md#3-4-2-%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%97%B0%EB%8F%99-url-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0```)
  - ğŸ’¡ ì •ì  ë¦¬ì†ŒìŠ¤ ê¸°ë³¸ ìœ„ì¹˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë£¨íŠ¸(```/**```)ë¶€í„° ë§¤í•‘
    + classpath:/META-INF/resources/
    + classpath:/resources/
    + classpath:/static/
    + classpath:/public/
    + ê¸°ë³¸ ìœ„ì¹˜ ë³€ê²½ : spring.mvc.static-path-pattern: "/ë³€ê²½ìœ„ì¹˜"
      

